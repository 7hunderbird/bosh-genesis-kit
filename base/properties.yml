---
instance_groups:
- name: bosh
  properties:
    agent:
      mbus: (( concat "nats://" meta.bosh.nats.user ":" meta.bosh.nats.pass "@" params.static_ip ":4222" ))
    blobstore:
      address: (( grab params.static_ip ))
      agent:
        user: (( grab meta.bosh.blobstore.agent.user ))
        password: (( grab meta.bosh.blobstore.agent.pass ))
      director:
        user: (( grab meta.bosh.blobstore.director.user ))
        password: (( grab meta.bosh.blobstore.director.pass ))
    director:
      ssl:
        cert: (( vault meta.vault "/ssl/server:certificate" ))
        key: (( vault meta.vault "/ssl/server:key" ))
      address: (( grab params.static_ip ))
      db: (( grab instance_groups.bosh.properties.postgres ))
      name: (( grab name ))
      user_management:
        local:
          users:
          - (( replace ))
          - name: (( grab meta.bosh.users.hm.username ))
            password: (( grab meta.bosh.users.hm.password ))
          - name: (( grab meta.bosh.users.admin.username ))
            password: (( grab meta.bosh.users.admin.password ))
    hm:
      director_account:
        user: (( grab meta.bosh.users.hm.username ))
        password: (( grab meta.bosh.users.hm.password ))
        ca_cert: (( vault meta.vault "/ssl/ca:certificate" ))
    nats:
      address: (( grab params.static_ip ))
      user: (( grab meta.bosh.nats.user ))
      password: (( grab meta.bosh.nats.pass ))
      tls:
         ca: (( vault meta.vault "/nats/ca:certificate" ))
         client_ca:
           certificate: (( vault meta.vault "/nats/ca:certificate" ))
           private_key: (( vault meta.vault "/nats/ca:key" ))
         server:
           certificate: (( vault meta.vault "/nats/server:certificate" ))
           private_key: (( vault meta.vault "/nats/server:key" ))
         director:
           certificate: (( vault meta.vault "/nats/director:certificate" ))
           private_key: (( vault meta.vault "/nats/director:key" ))
         health_monitor:
           certificate: (( vault meta.vault "/nats/health/monitor:certificate" ))
           private_key: (( vault meta.vault "/nats/health/monitor:key" ))
    postgres:
      user: (( grab meta.bosh.db.user ))
      password: (( grab meta.bosh.db.pass ))
    ntp: (( grab params.ntp ))
