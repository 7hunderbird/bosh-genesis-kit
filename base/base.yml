---
instance_groups:
- instances: 1
  name: bosh
  stemcell: default
  networks:
  - name: (( grab params.bosh_network ))
    static_ips: (( grab params.static_ip ))
  persistent_disk_pool: (( grab params.bosh_disk_pool ))
  vm_type: (( grab params.bosh_vm_type ))
  jobs:
  - name: postgres
    release: bosh
  - name: nats
    release: bosh
  - name: blobstore
    release: bosh
  - name: director
    release: bosh
  - name: health_monitor
    release: bosh
  - name: shield-agent
    release: shield
  - name: agent-pgtools
    release: shield
  properties: {} # required by bosh-init until https://github.com/cloudfoundry/bosh-init/issues/71 is resolved

meta:
  vault: (( concat "secret/" params.vault ))

  vcap_password: (( vault meta.vault "/vcap:password-crypt-sha512" ))

  bosh:
    blobstore:
      agent:
        user: blobstore-user
        pass: (( vault meta.vault "/blobstore/agent:password" ))
      director:
        user: director-user
        pass: (( vault meta.vault "/blobstore/director:password" ))
    users:
    - name: hm
      username: resurrector
      password: (( vault meta.vault "/users/hm:password" ))
    - name: admin
      username: admin
      password: (( vault meta.vault "/users/admin:password" ))
    db:
      user: boshdb
      pass: (( vault meta.vault "/db:password" ))
    nats:
      user: natsuser
      pass: (( vault meta.vault "/nats:password" ))

    registry:
      user: registry-user
      pass: (( vault meta.vault "/registry:password" ))

update:
  canaries: 1
  max_in_flight: 1
  serial: true

releases:
- name: bosh
  sha1: f46ad38ad49925e96ec93bd69d0e77f67ba07af9
  url: https://bosh.io/d/github.com/cloudfoundry/bosh?v=261.1
  version: 261.1
- name: shield
  version: latest

stemcells:
- alias: default
  os: (( grab params.stemcell_os ))
  version: (( grab params.stemcell_version ))
