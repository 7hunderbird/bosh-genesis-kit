---
instance_groups:
  - name: bosh
    jobs:
      - name: uaa
        properties:
          uaa:
            clients:
              director_to_credhub:
                secret: (( vault meta.vault "/uaa/clients/director_to_credhub:secret" ))
            scim:
              users:
              - name: credhub-cli
                password: (( vault meta.vault "/uaa/users/credhub-cli:password" ))

      - name: credhub
        properties:
          credhub:
            authentication:
              uaa:
                ca_certs:
                  - (( vault meta.vault "/ssl/ca:certificate" ))
                url: (( concat "https://" params.static_ip ":8443" )) # FIXME could be grabbed
                verification_key: (( vault meta.vault "/uaa/jwt:public" ))
            data_storage:
              username: (( grab meta.bosh.db.user ))
              password: (( grab meta.bosh.db.pass ))
            encryption:
              keys:
                - (( inline ))
                - encryption_password: (( vault meta.vault "/credhub/encryption:key" ))
            tls:
              certificate: (( vault meta.vault "/credhub/server:certificate" ))
              private_key: (( vault meta.vault "/credhub/server:key" ))

    properties:
      director:
        config_server:
          ca_cert: (( vault meta.vault "/credhub/ca:certificate" ))
          url: (( concat "https://" params.static_ip ":8844/api/" ))
          uaa:
            ca_cert: (( vault meta.vault "/ssl/ca:certificate" ))
            client_secret: (( vault meta.vault "/uaa/clients/director_to_credhub:secret" ))
            url: (( concat "https://" params.static_ip ":8443" ))
