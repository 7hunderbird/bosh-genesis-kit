---
params:
  azure:
    environment: AzureCloud
    subscription_id: (( param "Specify the Azure Subscription ID" ))
    tenant_id: (( param "Specify the Azure Tenant ID" ))
    client_id: (( param "Specify the App ID to connect to Azure with" ))
    client_secret: (( param "Specify the App key to connect to Azure with" ))
    resource_group_name: (( param "Specify the resource group for Azure" ))
    storage_account_name: (( param "Specify the storage acct for Azure to create VM disks" ))
    default_security_group: (( param "Specify the default security group for your Azure VMs" ))
    ssh_public_key: (( param "Specify teh SSH Public key to be used to access your Azure VMs" ))

instance_groups:
- name: bosh
  jobs:
  - name: azure_cpi
    release: bosh-azure-cpi
  - name: registry
    release: bosh

releases:
- name: bosh-azure-cpi
  version: 20
  sha1: fb0180c685714d064b5a467eb6f2b34388fadf0a
  url: https://bosh.io/d/github.com/cloudfoundry-incubator/bosh-azure-cpi-release?v=20

properties:
  registry:
    address: (( grab params.static_ip ))
    host:    (( grab params.static_ip ))
    db:      (( grab properties.postgres ))

    username: (( grab meta.bosh.registry.user ))
    password: (( grab meta.bosh.registry.pass ))
    port: 25777
    http:
      user:     (( grab properties.registry.username ))
      password: (( grab properties.registry.password ))
      port:     (( grab properties.registry.port ))

  director:
    cpi_job: azure_cpi
  azure: 
    environment: (( grab params.azure.environment ))
    subscription_id: (( grab params.azure.subscription_id ))
    tenant_id: (( grab params.azure.tenant_id ))
    client_id: (( grab params.azure.client_id ))
    client_secret: (( grab params.azure.client_secret ))
    resource_group_name: (( grab params.azure.resource_group_name ))
    storage_account_name: (( grab params.azure.storage_account_name ))
    default_security_group: (( grab params.azure.default_security_group ))
    ssh_user: vcap
    ssh_public_key: (( grab params.azure.ssh_public_key ))
