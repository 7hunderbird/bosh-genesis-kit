---
vm_types:
- name: (( grab params.bosh_vm_type ))
  cloud_properties:
    instance_type: (( grab params.protobosh_vm.instance_type ))
    ephemeral_disk:
      type: (( grab params.protobosh_vm.disk_type ))
      size: (( grab params.protobosh_vm.ephemeral_disk ))
    availability_zone: (( grab params.protobosh_vm.availability_zone ))
  env:
    bosh:
      password: (( grab meta.vcap_password ))

networks:
- name: (( grab params.bosh_newtork ))
  type: manual
  subnets:
  - range: (( grab params.protobosh_network.range ))
  gateway: (( grab params.protobosh_network.gateway ))
  dns: (( grab params.protobosh_network.dns ))
  static: [ (( grab params.protobosh_network.static_ip )) ]
  cloud_properties:
    security_groups: (( grab params.protobosh_network.security_groups ))
    subnet: (( grab params.protobosh_network.subnet_id ))

disk_pools:
- name: (( grab params.bosh_disk_pool ))
  disk_size: (( grab params.protobosh_vm.persistent_disk ))
  cloud_properties:
    type: (( grab params.protobosh_vm.disk_type ))


cloud_provider:
  mbus: (( concat "https://mbus:mbus-password@" params.static_ip ":6868" ))

  template:
    name: aws_cpi
    release: bosh-aws-cpi
  ssh_tunnel:
    port 22
  user: vcap
  host: (( grab params.static_ip ))
  private_key: (( vault meta.vault "/aws/ssh:private" ))

  properties:
    agent:
      mbus: https://mbus:mbus-password@0.0.0.0:6868
    blobstore:
      path: /var/vcap/micro_bosh/data/cache
      provider: local
    ntp: (( grab params.ntp ))
    aws: (( grab properties.aws )) 
